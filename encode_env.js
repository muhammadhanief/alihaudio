const fs = require('fs');
const path = require('path');

const json = fs.readFileSync(path.join(__dirname, '.env.local'), 'utf8').split('=')[1].trim();
// If it was already in a weird format, let's just use the known good JSON string from the user's message
const actualJson = `{"type": "service_account","project_id": "gen-lang-client-0566608121","private_key_id": "26940d6a131d91be604d607cd9f8f1fc5d62a946","private_key": "-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDQcnK6TSIaIzl1\\nNa6tbXH9n5KBMIM3qxRdadNQtWJb/NsZAFZXLGVO+ZENvBLfZ+QaaBg1tNaabDYB\\nA/OkMk8oHzYwMal4HaAb9lak6KnAWi1JY3lt5dYvmazar/Ot2+jU2IXkKjbe1b+X\\ncCewwq0VVT+a+SxAOVdb15dmCEX6S1Wo4KmCNcj7a+MXbn3w/X21Y9hg9+MwbZpE\\nUsdZvCwndJJkrdpEp65Ds5gY28/Zp+2hOLB+l7BlyfOZXqHQSgC30kHi64objb6Z\\nGlA2SFfnAMrIEQbNISGYX1N3WBSU5i6VM3bEgljz9doc5WbWEfXSakPgpnwXJf8W\\n9EUzpJT1AgMBAAECggEAB6tST8rzOIF3xXl4aA6ZDVMP7ZtmlIeBnA8+9F78E7TZ\\nrdGOm635Oz7g6J+1FQ2qPZN7Yox5Adz93qsxzWaBdZEyafMF0HLMl4LIfNBHoJlg\\nxay4hMPaTc2KZ9Bl941aA2zE/lhURP4Zyr1YZH9BJYIJsU6+I03IyksEGb+vrW4D\\noyeAMI/blNoRrPIJ54AYRF5avjZ1ziFSGEEhbtpgTcxP7q94n2GWJ3f3Vk+PulAv\\n61/o7kfjOn09DMHetkYy3eQkmD0E9D1I0OqcEUAszZGGqAZQ53K5EDHKbU8zEqQ2\\n2z5CZ7Ypur+iZavRZBDKhSDRn4x1VVBnK+NioiflmQKBgQDtuzaReLmFb9kDbbt6\\nH7YPjz38szignddbOIz5kaFowNdg+QwDFSJCt+Ii9u1ooFFyc6KOuXAGzGIYg7/O\\nLIHY7Ysmfz7NDilhQ8KedjjmrYaLd2UKfOGbXwOsczsv8cf83lrobhZamgO7btJr\\nOfHr64z/R4b+VihA5/hwZMEjLQKBgQDgdyN8+Hd/YDAN0X1qX2LmT0aFEG+obqKk\\n6Dw3J/gHhCt2KkTUkti7gxl8v0+fliN4A1KhC+jIbYjsXSkJFJ9YU42hmX2Go8ga\\nvnv6tALNbth5mLXd68x9LIheKxJb1tLcC2bsQDZR/262UMY7MSJ2BIj1SBaZa/y\\n+MB7Auh16QKBgQDRS7tVA3ZB1iC29grSD80XkcK/EYJPVeddtkHXDrGOKgj0pQ5A\\nQIDzQDTlF4QYUtyh6NA622OXeKT8dDGPcHu44hlaATjnCwq/SQq0u9yIqkkDzE+2\\nlg+B3Hq9fo2jPjgVliVu8EzZ4zJZ981k/ZTRYYW20eA1VuEFk7SULwAi2QKBgQCi\\ndzkVfBWp+Snu5oEbG/1Oa3TEXRgkViecqobi+Sf58L0wYvm8zqjWV9Z7x1DPVnFH\\nrUgCTsdnQnjHc8p+yxFmcdtiauFDMYplaRf9Zotcu+0tXc3M2Z4BwVJ9rYUuBc6T\\ndJdeSCgwHH5W3mhFQyIiD2VZ0CoBo/ZNK6TNpFYy+QKBgQDhNw98ufK97kDVnTzr\\n+gGPHox8QQBEwa5CKDiSSmOSrfVchghia6Bv2DVdEPoGZzDKX+ISLuOXzL0PbZ8Y\\nm9iLL2UB+e8EjpelPiWO8NKsfpmrvzDUxhMBmO9nAEKotlRKOATB3uFgrPftObnk\\nvGxoa+btK+ZWLscHLxMk2aTo9g==\\n-----END PRIVATE KEY-----\\n","client_email": "text-to-speech@gen-lang-client-0566608121.iam.gserviceaccount.com","client_id": "106510849424165949902","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/text-to-speech%40gen-lang-client-0566608121.iam.gserviceaccount.com","universe_domain": "googleapis.com"}`;

const base64 = Buffer.from(actualJson).toString('base64');
fs.writeFileSync(path.join(__dirname, '.env.local'), `GOOGLE_APPLICATION_CREDENTIALS_BASE64=${base64}`);
console.log("Updated .env.local with base64 encoded credentials.");
