(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3981],{452:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(5155),r=s(2115),n=s(1878),l=s(2622),i=s(7810),o=s(4478),c=s(5311),d=s(1337),x=s(2967),p=s(9698),m=s(8434);function u(){let[e,t]=(0,r.useState)([]),[s,u]=(0,r.useState)(null),[g,h]=(0,r.useState)(!0),[f,b]=(0,r.useState)(""),[j,k]=(0,r.useState)("");(0,r.useEffect)(()=>{fetch((0,d.e)(`/api/auth/session?t=${Date.now()}`)).then(async e=>{u((await e.json()).user),N()})},[]);let N=async()=>{let e=await fetch((0,d.e)(`/api/admin/users?t=${Date.now()}`));e.ok&&(t((await e.json()).users),h(!1))},y=async(e,t)=>{let s=await fetch((0,d.e)("/api/admin/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetNipp:e,newRole:t})});if(s.ok)m.Ay.success("Berhasil mengubah role pengguna"),N();else{let e=await s.json();m.Ay.error(e.error||"Gagal mengubah role pengguna"),N()}},w=(0,r.useMemo)(()=>{let t=e.filter(e=>e.kd_satker).map(e=>({kd:e.kd_satker,nama:e.satker})),s=[],a=new Map;for(let e of t)a.has(e.kd)||(a.set(e.kd,!0),s.push(e));return s.sort((e,t)=>e.kd.localeCompare(t.kd))},[e]),{search:v,setSearch:_,sortConfig:A,toggleSort:S,filteredAndSorted:C}=(0,x.H)(e,["nama","nipp","nip_lama","kd_satker","satker"]);(0,r.useEffect)(()=>{_(f)},[f,_]);let $=({columnKey:e})=>(0,a.jsx)(p.y,{columnKey:e,sortConfig:A}),D=(0,r.useMemo)(()=>{let e=C;return j&&(e=e.filter(e=>e.kd_satker===j)),e},[C,j]);return(0,a.jsxs)("div",{className:"space-y-6 animate-fade-in",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-orange-950 tracking-tighter uppercase",children:"Manajemen User"}),(0,a.jsxs)("p",{className:"text-orange-900/50 text-xs font-medium uppercase tracking-widest mt-1",children:["Delegasi peran dan akses sistem (",e.length," Total)"]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(n.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-orange-400 pointer-events-none"}),(0,a.jsx)("input",{type:"text",placeholder:"Cari nama, NIP, atau satker...",value:f,onChange:e=>b(e.target.value),className:"w-full pl-11 pr-5 py-3.5 rounded-2xl border border-orange-200/60 text-sm font-medium shadow-sm outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500/40 transition-all bg-white/80",style:{color:"#1c0a00"}}),f&&(0,a.jsxs)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-medium text-orange-900/40 uppercase tracking-wider",children:[D.length," hasil"]})]}),(0,a.jsxs)("div",{className:"relative w-full md:w-72 flex-shrink-0",children:[(0,a.jsx)(l.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-orange-400 pointer-events-none"}),(0,a.jsxs)("select",{value:j,onChange:e=>k(e.target.value),className:"w-full pl-11 pr-10 py-3.5 rounded-2xl border border-orange-200/60 text-sm font-medium shadow-sm outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500/40 transition-all bg-white/80 appearance-none translate-y-0",style:{color:"#1c0a00"},children:[(0,a.jsx)("option",{value:"",children:"Semua Satuan Kerja"}),w.map(e=>(0,a.jsx)("option",{value:e.kd,children:e.kd},e.kd))]})]})]}),g&&(0,a.jsxs)("div",{className:"glass rounded-[32px] p-24 flex flex-col items-center justify-center gap-4 text-orange-600 border border-orange-200/50",children:[(0,a.jsx)("div",{className:"w-10 h-10 border-4 border-orange-200 border-t-orange-600 rounded-full animate-[spin_0.8s_linear_infinite]"}),(0,a.jsx)("p",{className:"text-[10px] font-bold uppercase tracking-widest text-orange-900/40 animate-[pulse_1.5s_cubic-bezier(0.4,0,0.6,1)_infinite]",children:"Memuat Data..."})]}),!g&&0===D.length&&(0,a.jsxs)("div",{className:"glass rounded-[32px] p-16 flex flex-col items-center gap-4 text-orange-900/20 border border-orange-200/50",children:[(0,a.jsx)(i.A,{className:"h-12 w-12"}),(0,a.jsx)("p",{className:"text-sm font-semibold uppercase tracking-widest",children:"Tidak ada pengguna ditemukan"})]}),!g&&D.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"md:hidden space-y-3",children:D.map(e=>(0,a.jsxs)("div",{className:"glass rounded-[24px] p-4 border border-orange-200/50 shadow-sm space-y-3 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.foto_url?(0,a.jsx)("img",{src:e.foto_url,alt:e.nama,className:"w-12 h-12 rounded-xl object-cover border border-orange-100 shadow-sm flex-shrink-0"}):(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-lg flex-shrink-0",children:e.nama?.charAt(0)||"?"}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-bold text-orange-950 leading-tight break-words whitespace-normal",children:e.nama}),"superadmin"===e.role&&(0,a.jsx)(o.A,{className:"h-4 w-4 text-purple-600 flex-shrink-0"})]}),(0,a.jsxs)("span",{className:"text-[10px] font-medium text-zinc-500 tracking-tight",children:[e.nipp,e.nip_lama?` / ${e.nip_lama}`:""]})]})]}),(0,a.jsx)("div",{className:"text-[10px] font-medium text-orange-900/50 leading-snug",children:e.kd_satker?`[${e.kd_satker}] ${e.satker}`:e.satker}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-orange-100",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-[8px] font-semibold text-orange-900/30 uppercase tracking-widest",children:"Login Terakhir"}),(0,a.jsx)("span",{className:"text-[10px] font-medium text-zinc-500",suppressHydrationWarning:!0,children:e.last_login?new Date(e.last_login).toLocaleString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"})]}),e.nipp!==s?.nipp?e.role===s?.role?(0,a.jsxs)("span",{className:"text-[10px] font-medium text-orange-600 italic opacity-50",children:["Setingkat (",e.role,")"]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-3.5 w-3.5 text-orange-400"}),(0,a.jsxs)("select",{value:e.role,onChange:t=>y(e.nipp,t.target.value),className:`text-[9px] font-semibold border rounded-lg px-2 py-1 outline-none hover:border-orange-500 transition-colors cursor-pointer ${"superadmin"===e.role?"bg-purple-100 border-purple-200 text-purple-700":"admin"===e.role?"bg-blue-100 border-blue-200 text-blue-700":"bg-zinc-100 border-zinc-200 text-zinc-700"}`,children:[(0,a.jsx)("option",{value:"user",children:"USER"}),(0,a.jsx)("option",{value:"admin",children:"ADMIN"}),(0,a.jsx)("option",{value:"superadmin",children:"SUPERADMIN"})]})]}):(0,a.jsx)("span",{className:"text-[10px] font-medium text-orange-600 italic opacity-50",children:"Akun Anda"})]})]},e.nipp))}),(0,a.jsx)("div",{className:"hidden md:block glass rounded-[40px] overflow-hidden shadow-xl border border-orange-200/50 overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left border-collapse min-w-[700px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-orange-500/5 border-b border-orange-100",children:[(0,a.jsxs)("th",{className:"px-6 py-4 text-[10px] font-semibold text-orange-900/40 uppercase tracking-widest cursor-pointer group hover:bg-orange-500/10 transition-colors",onClick:()=>S("nama"),children:["Data Pengguna ",(0,a.jsx)($,{columnKey:"nama"})]}),(0,a.jsxs)("th",{className:"px-6 py-4 text-[10px] font-semibold text-orange-900/40 uppercase tracking-widest cursor-pointer group hover:bg-orange-500/10 transition-colors",onClick:()=>S("nipp"),children:["NIP / NIPP ",(0,a.jsx)($,{columnKey:"nipp"})]}),(0,a.jsxs)("th",{className:"px-6 py-4 text-[10px] font-semibold text-orange-900/40 uppercase tracking-widest cursor-pointer group hover:bg-orange-500/10 transition-colors",onClick:()=>S("role"),children:["Peran ",(0,a.jsx)($,{columnKey:"role"})]}),(0,a.jsxs)("th",{className:"px-6 py-4 text-[10px] font-semibold text-orange-900/40 uppercase tracking-widest cursor-pointer group hover:bg-orange-500/10 transition-colors",onClick:()=>S("last_login"),children:["Login Terakhir ",(0,a.jsx)($,{columnKey:"last_login"})]}),(0,a.jsx)("th",{className:"px-6 py-4 text-[10px] font-semibold text-orange-900/40 uppercase tracking-widest",children:"Aksi"})]})}),(0,a.jsx)("tbody",{children:D.map(e=>(0,a.jsxs)("tr",{className:"border-b border-orange-50/50 hover:bg-orange-50/30 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[e.foto_url?(0,a.jsx)("img",{src:e.foto_url,alt:e.nama,className:"w-10 h-10 rounded-xl object-cover border border-orange-100 shadow-sm flex-shrink-0"}):(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center text-orange-600 font-bold flex-shrink-0",children:e.nama?.charAt(0)||"?"}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,a.jsx)("span",{className:"text-[11px] font-semibold text-orange-950 truncate",children:e.nama}),(0,a.jsx)("span",{className:"text-[9px] font-medium text-orange-900/40 tracking-tighter truncate max-w-[200px]",title:e.satker,children:e.kd_satker?`[${e.kd_satker}] ${e.satker}`:e.satker})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 text-[11px] font-medium text-zinc-500",children:[e.nipp,e.nip_lama&&(0,a.jsx)("span",{className:"block text-[9px] text-zinc-400 mt-0.5",children:e.nip_lama})]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["superadmin"===e.role&&(0,a.jsx)(o.A,{className:"h-4 w-4 text-purple-600"}),(0,a.jsx)("span",{className:`px-2 py-1 rounded-lg text-[9px] font-bold uppercase tracking-wider ${"superadmin"===e.role?"bg-purple-100 text-purple-600":"admin"===e.role?"bg-blue-100 text-blue-600":"bg-zinc-100 text-zinc-600"}`,children:e.role})]})}),(0,a.jsx)("td",{className:"px-6 py-4 text-[11px] text-zinc-400",suppressHydrationWarning:!0,children:e.last_login?new Date(e.last_login).toLocaleString("id-ID"):"-"}),(0,a.jsx)("td",{className:"px-6 py-4",children:e.nipp!==s?.nipp?e.role===s?.role?(0,a.jsxs)("span",{className:"text-[10px] font-medium text-orange-600 italic opacity-50",children:["Setingkat (",e.role,")"]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 text-orange-400"}),(0,a.jsxs)("select",{value:e.role,onChange:t=>y(e.nipp,t.target.value),className:"text-[10px] font-semibold border border-orange-200 rounded-lg px-3 py-1.5 outline-none hover:border-orange-500 transition-colors cursor-pointer",style:{color:"#1c0a00",backgroundColor:"#fff7ed"},children:[(0,a.jsx)("option",{value:"user",children:"USER"}),(0,a.jsx)("option",{value:"admin",children:"ADMIN"}),(0,a.jsx)("option",{value:"superadmin",children:"SUPERADMIN"})]})]}):(0,a.jsx)("span",{className:"text-[10px] font-medium text-orange-600 italic opacity-50",children:"Akun Anda"})})]},e.nipp))})]})})]})]})}},1337:(e,t,s)=>{"use strict";s.d(t,{e:()=>r,s:()=>n});let a="/alihaudio",r=e=>{let[t,s]=e.split("?"),r=t.startsWith("/")?t:`/${t}`;if(!r.endsWith("/")){let e=r.split("/"),t=e[e.length-1];t&&!t.includes(".")&&(r+="/")}let n=s?`${r}?${s}`:r;return`${a}${n}`},n=e=>{if(!e)return"";if(e.startsWith("http"))return e;if(e.startsWith("/uploads/audio/")){let t=e.replace("/uploads/audio/","");return`${a}/api/audio/${t}`}let t=e.startsWith("/")?e:`/${e}`;return`${a}${t}`}},2362:(e,t,s)=>{Promise.resolve().then(s.bind(s,452))},2967:(e,t,s)=>{"use strict";s.d(t,{H:()=>r});var a=s(2115);function r(e,t=[],s){let[n,l]=(0,a.useState)(""),[i,o]=(0,a.useState)(s||{key:"",direction:null}),c=(0,a.useMemo)(()=>{let s=[...e];if(n.trim()&&t.length>0){let e=n.toLowerCase();s=s.filter(s=>t.some(t=>{let a=s[t];return null!=a&&String(a).toLowerCase().includes(e)}))}return i.key&&i.direction&&s.sort((e,t)=>{let s=e[i.key],a=t[i.key];return(null==s&&(s=""),null==a&&(a=""),"created_at"===i.key||i.key.includes("date")?(s=s?new Date(s).getTime():0,a=a?new Date(a).getTime():0):"string"==typeof s&&"string"==typeof a&&(s=s.toLowerCase(),a=a.toLowerCase()),s<a)?"asc"===i.direction?-1:1:s>a?"asc"===i.direction?1:-1:0}),s},[e,n,i,t]);return{search:n,setSearch:l,sortConfig:i,toggleSort:e=>{let t="asc";i.key===e&&"asc"===i.direction?t="desc":i.key===e&&"desc"===i.direction&&(t=null),o({key:e,direction:t})},filteredAndSorted:c}}},9698:(e,t,s)=>{"use strict";s.d(t,{y:()=>i});var a=s(5155),r=s(5770),n=s(2055),l=s(6842);function i({columnKey:e,sortConfig:t}){return t.key===e&&t.direction?"asc"===t.direction?(0,a.jsx)(n.A,{className:"h-3 w-3 text-orange-600 inline-block ml-1"}):(0,a.jsx)(l.A,{className:"h-3 w-3 text-orange-600 inline-block ml-1"}):(0,a.jsx)(r.A,{className:"h-3 w-3 text-orange-900/30 inline-block ml-1 opacity-0 group-hover:opacity-100 transition-opacity"})}}},e=>{e.O(0,[1618,8441,3794,7358],()=>e(e.s=2362)),_N_E=e.O()}]);